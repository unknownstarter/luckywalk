# LuckyWalk PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.1 앱 정보
- **앱명**: LuckyWalk
- **플랫폼**: Flutter (iOS/Android)
- **백엔드**: Supabase (서버/DB/Auth/Storage/Edge Functions)
- **광고**: Google AdMob SDK (Rewarded Video, Interstitial, Banner)
- **아키텍처**: Clean Architecture + Riverpod + GoRouter
- **타임존**: Asia/Seoul (KST)

### 1.2 핵심 콘셉트
"매주 걸어서/광고 시청으로 무료 복권을 받아 로또 6/45(실제 발표 번호 기준)와 매칭해 당첨을 결정. 일요일 정오(KST)에 당첨 알림/정산"

### 1.3 비즈니스 모델
- **수익원**: 광고 수익 (AdMob)
- **비용**: 당첨금 지급 (1등 100만원 n분의1, 2등 50만원 n분의1, 3등 전원 50장)
- **운영비**: 서버/스토리지 비용

## 2. 목표 및 KPI

### 2.1 핵심 지표
- **D1 리텐션**: 70% 이상
- **D7 리텐션**: 40% 이상
- **주간 응모장수**: 사용자당 평균 50장 이상
- **RV 완료율**: 60% 이상
- **초대 전환율**: 15% 이상
- **재방문율**: 80% 이상
- **부정사용율**: 1% 미만

### 2.2 성장 지표
- **MAU**: 3개월 내 10만명
- **DAU/MAU**: 0.3 이상
- **평균 세션 시간**: 5분 이상
- **광고 완료율**: 70% 이상

## 3. 사용자 여정 (User Journey)

### 3.1 온보딩 플로우
1. **스플래시** → 앱 로딩
2. **로그인** → Apple/Kakao OAuth
3. **권한 요청** → 알림/건강/활동 권한
4. **홈 진입** → 메인 화면

### 3.2 일일 활동 플로우
1. **홈 진입** → 당일 미션 확인
2. **걸음수 보상** → 1k~10k 걸음 달성 시 복권 지급
3. **광고 시청** → 1~10번 순차 해금, 복권 지급
4. **출석체크** → 1일 1회 3장 지급
5. **초대** → 친구 초대 시 양측 100장 지급

### 3.3 응모 플로우
1. **복권 보유** → 홈에서 보유 복권 수 확인
2. **응모 신청** → 원하는 장수 선택
3. **번호 생성** → 자동/수동 번호 선택
4. **응모 완료** → 해당 회차에 응모

### 3.4 결과 확인 플로우
1. **당첨 발표** → 토요일 20:50 KST 번호 확정
2. **결과 알림** → 일요일 12:00 KST 푸시 발송
3. **당첨 확인** → 앱에서 결과 확인
4. **KYC 제출** → 1,2등 당첨 시 신분증/통장 제출
5. **당첨금 수령** → 어드민 승인 후 송금

## 4. 핵심 정책

### 4.1 광고보고 복권 정책
- **순차 해금**: 1→2→3...→10번 순서로 해금
- **일일 제한**: 하루 최대 10회
- **방어코딩**: 중복탭/포커스 전환/백그라운드 복귀 시 재검증
- **서버 검증**: 모든 광고 시청은 서버에서 검증 후 지급

### 4.2 걸음수 보상 정책
- **임계값**: 1k, 2k, 3k, 4k, 5k, 6k, 7k, 8k, 9k, 10k 걸음
- **지급 방식**: 각 임계값 달성 시 1회만 지급
- **리셋**: 매일 자정 KST 리셋
- **권한**: HealthKit/Google Fit 권한 필요

### 4.3 출석체크 정책
- **지급량**: 1일 1회 3장
- **시간**: 자정 KST 리셋
- **조건**: 앱 진입 시 자동 체크

### 4.4 초대 정책
- **지급량**: 초대자/피초대자 각 100장
- **제한**: 무제한 (반 어뷰징 시스템 적용)
- **검증**: 디바이스/네트워크/결제 프로필/쿠키 지표 교차검증

### 4.5 당첨금 정책
- **1등**: 100만원 n분의1 (당첨자 수만큼 분할)
- **2등**: 50만원 n분의1 (당첨자 수만큼 분할)
- **3등**: 전원 50장 지급
- **4등**: 10장 지급
- **5등**: 5장 지급

### 4.6 KYC 정책
- **대상**: 1등, 2등 당첨자만
- **제출 서류**: 주민등록증, 통장사본
- **정보**: 실명, 주민등록번호, 은행명, 계좌번호
- **보안**: 민감정보 암호화·분리보관
- **접근감사**: 모든 접근 로깅

## 5. 기술 요구사항

### 5.1 인증
- **방식**: Sign in with Apple, Kakao
- **세션**: 30일 유지
- **보안**: JWT 토큰 기반

### 5.2 데이터베이스
- **플랫폼**: Supabase PostgreSQL
- **보안**: RLS (Row Level Security) 적용
- **백업**: 일일 자동 백업

### 5.3 스토리지
- **KYC 문서**: Supabase Storage
- **접근 제어**: 서명 URL (5분 유효)
- **암호화**: AES-GCM 서버사이드 암호화

### 5.4 푸시 알림
- **플랫폼**: Firebase FCM
- **발송 시점**: 일요일 12:00 KST
- **대상**: 당첨자만

## 6. 보안 및 컴플라이언스

### 6.1 개인정보 보호
- **민감정보**: 주민등록번호, 계좌번호 암호화 저장
- **보존기간**: 최소 필요 기간만 보존
- **파기정책**: 명시적 파기 절차

### 6.2 접근 제어
- **RLS**: 모든 테이블에 적용
- **감사로그**: 모든 관리자 행위 기록
- **2단계 인증**: 위험 작업 시 적용

### 6.3 어뷰징 방지
- **탐지 지표**: 동일 디바이스, VPN/프록시, 설치-가입-탈퇴 루프
- **대응**: 보상 보류, 리뷰 큐 이동
- **임계치**: 자동화된 탐지 시스템

## 7. 운영 정책

### 7.1 회차 관리
- **생성**: 매주 일요일 새 회차 생성
- **응모 기간**: 일요일 12:00 ~ 토요일 20:00
- **발표**: 토요일 20:50 KST (실제 로또 번호 반영)

### 7.2 정산 정책
- **발표**: 일요일 12:00 KST 푸시 발송
- **KYC 기한**: 발표 후 7일 내 제출
- **송금**: KYC 승인 후 3일 내 처리

### 7.3 고객지원
- **채널**: 앱 내 문의, 이메일
- **응답시간**: 24시간 내
- **FAQ**: 앱 내 이용방법 섹션

## 8. 성공 지표 및 측정

### 8.1 정량적 지표
- 사용자 수, 리텐션, 참여도, 수익성
- 광고 완료율, 걸음수 달성률
- 응모 참여율, 당첨자 만족도

### 8.2 정성적 지표
- 사용자 피드백, 앱스토어 평점
- 고객지원 문의량, 이탈 원인 분석

## 9. 리스크 관리

### 9.1 기술적 리스크
- 서버 장애, 데이터 손실, 보안 침해
- 광고 SDK 오류, 푸시 알림 실패

### 9.2 비즈니스 리스크
- 어뷰징, 과도한 당첨금 지급
- 법적 규제 변경, 경쟁사 등장

### 9.3 대응 방안
- 백업 시스템, 모니터링, 자동화
- 어뷰징 탐지, 예산 관리, 차별화 전략

---

## 10. 구현 현황 (2025-09-17)

### 10.1 완료된 기능 ✅

#### 10.1.1 UI/UX 구현
- **스플래시 화면**: Figma 디자인 완벽 구현 (Baloo 폰트, 그라데이션 배경)
- **로그인 화면**: Apple/Kakao 로그인 버튼, Figma 디자인 매칭
- **홈 화면**: Figma 디자인 완벽 구현, 정책 반영 완료
- **응모하기 바텀시트**: Figma 디자인 완벽 구현, 0장 비활성화 로직

#### 10.1.2 핵심 정책 구현
- **걸음수 보상**: 10단계 (1k~10k 걸음, 1~10장 복권)
- **광고보고 보상**: 10단계 순차 해금 (1~10번 광고, 1~10장 복권)
- **출석체크**: 최대 5번 (1회당 3장, 총 15장)
- **로또 발표 시간**: 한국 시간 정책 (토요일 밤 9시, 응모 마감 오후 8시 30분)

#### 10.1.3 기술 구현
- **디자인 시스템**: AppText, AppColors, AppTextStyle 완성
- **컴포넌트**: 재사용 가능한 AppBottomSheet, RewardCard, LottoInfoCard
- **라우팅**: GoRouter ShellRoute로 하단 네비게이션 구현
- **상태 관리**: Riverpod Mock Provider로 데이터 관리
- **권한 관리**: Notification, Activity Recognition 권한 요청

#### 10.1.4 로또 시간 정책
- **LottoDateTime 유틸리티**: 한국 시간대 (UTC+9) 정확한 계산
- **실시간 회차**: 2024년 1월 6일 1회차 기준 자동 계산
- **발표 시간**: 매주 토요일 밤 9시 (실제 로또와 동일)
- **응모 마감**: 매주 토요일 오후 8시 30분
- **UI 반영**: HomeScreen, SubmitModalScreen에 실시간 표시

### 10.2 진행 중인 작업 🔄

#### 10.2.1 Supabase 연동
- **DB 스키마**: 완성 (사용자, 회차, 복권, 보상, KYC, 로깅 테이블)
- **RLS 정책**: 보안 정책 적용 완료
- **로깅 시스템**: 에러/이벤트/보안 코드 정의 완료
- **인증 시스템**: SupabaseAuthNotifier 구현 완료
- **환경 변수**: flutter_dotenv로 안전한 설정 관리

#### 10.2.2 실제 데이터 연동 준비
- **Mock → Real**: Mock Provider를 Supabase Provider로 전환 준비
- **인증 플로우**: Apple/Kakao 로그인 실제 연동 준비
- **데이터 동기화**: 실시간 데이터 업데이트 준비

### 10.3 예정된 작업 📋

#### 10.3.1 백엔드 연동
- **Supabase 스키마 적용**: SQL 마이그레이션 실행
- **실제 인증**: Apple/Kakao OAuth 연동
- **데이터 CRUD**: 복권, 보상, 응모 데이터 관리
- **로깅 시스템**: 실제 이벤트 로깅 구현

#### 10.3.2 고급 기능
- **푸시 알림**: Firebase FCM 연동
- **광고 시스템**: Google AdMob 연동
- **걸음수 연동**: HealthKit/Google Fit 연동
- **KYC 시스템**: 신분증/통장 업로드 기능

### 10.4 기술 스택 현황

#### 10.4.1 Frontend
- **Flutter**: 3.9.2+ (최신)
- **Riverpod**: 상태 관리 완료
- **GoRouter**: 네비게이션 완료
- **디자인 시스템**: 완성

#### 10.4.2 Backend
- **Supabase**: 프로젝트 생성 완료
- **PostgreSQL**: 스키마 설계 완료
- **RLS**: 보안 정책 완료
- **Edge Functions**: 준비 완료

#### 10.4.3 개발 도구
- **환경 관리**: flutter_dotenv
- **날짜/시간**: intl 패키지
- **권한 관리**: permission_handler
- **로깅**: 커스텀 AppLogger

### 10.5 코드 품질
- **에러**: 0개
- **경고**: 1개 (deprecated API)
- **정보**: 27개 (경미한 스타일 이슈)
- **테스트**: 단위 테스트 기반 구축

### 10.6 다음 단계
1. **Supabase 스키마 적용** (우선순위: 높음)
2. **실제 인증 시스템 연동** (우선순위: 높음)
3. **Mock 데이터 → 실제 데이터 전환** (우선순위: 중간)
4. **푸시 알림 시스템** (우선순위: 중간)
5. **광고 시스템 연동** (우선순위: 낮음)

---

**마지막 업데이트**: 2025-09-17 00:15:30 KST
