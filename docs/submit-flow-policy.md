# 응모하기 플로우 정책 문서

**작성일**: 2025-01-17 01:15:00 KST  
**버전**: v1.0.0  
**상태**: 구현 완료  

## 📋 개요

LuckyWalk 앱의 복권 응모하기 플로우와 관련된 모든 정책, 검증 로직, 사용자 경험을 정의합니다.

## 🎯 핵심 정책

### 1. 응모 시간 정책
- **응모 마감**: 매주 토요일 오후 8시 30분 (UTC+9)
- **발표 시간**: 매주 토요일 오후 9시 (UTC+9)
- **응모 시작**: 발표 후 즉시 다음 회차 응모 가능
- **시간 검증**: 응모 완료 시점에서 최종 검증

### 2. 응모 수량 정책
- **최소 수량**: 100장
- **최대 수량**: 10,000장
- **증가 단위**: 100장 단위
- **수량 검증**: 응모 시작 시점과 완료 시점에서 이중 검증

### 3. 복권 번호 정책
- **번호 범위**: 1-45
- **선택 개수**: 6개
- **중복 금지**: 동일한 번호 중복 선택 불가
- **자동 생성**: 랜덤 번호 자동 생성 지원
- **수동 선택**: 사용자 직접 번호 선택 지원

## 🔄 응모 플로우

### 1단계: 응모 시작 (SubmitModalScreen)
```
홈 화면 → 응모하기 버튼 → 바텀시트 모달
```

**검증 항목**:
- [ ] 응모 시간 확인 (토요일 오후 8시 30분 이전)
- [ ] 응모 수량 유효성 (100장~10,000장, 100장 단위)
- [ ] 남은 시간 표시 (실시간)

**사용자 경험**:
- 남은 시간 확인 토스트
- 수량 조절 (+/- 버튼, 숫자 키패드)
- 응모 규칙 안내

### 2단계: 복권 생성 중 (SubmitLoadingScreen)
```
바텀시트 → 응모하기 버튼 → 로딩 화면
```

**표시 내용**:
- 로딩 애니메이션
- "로또 6/45에 응모할 복권 X장을 만들고 있어요!"
- 자동으로 다음 단계로 이동 (2초 후)

### 3단계: 복권 확인 (SubmitConfirmScreen)
```
로딩 화면 → 복권 확인 화면
```

**기능**:
- 생성된 복권 목록 표시
- 각 복권별 번호와 색상 표시
- 개별 복권 수정 가능 (편집 버튼)
- 응모하기 버튼 (최종 제출)

**검증 항목**:
- [ ] 시간 검증 (응모 마감 시간 확인)
- [ ] 수량 검증 (응모 수량 유효성)
- [ ] 번호 검증 (각 복권의 번호 유효성)

### 4단계: 번호 수정 (SubmitEditScreen)
```
복권 확인 → 편집 버튼 → 번호 수정 화면
```

**기능**:
- 9x5 그리드 번호 선택 (1-45)
- 최대 6개 번호 선택
- 자동 번호 생성 버튼
- 확인 버튼 (수정된 번호 반영)

### 5단계: 응모 완료 (SubmitCompleteScreen)
```
복권 확인 → 응모하기 → 완료 화면
```

**표시 내용**:
- 성공 메시지
- "X장의 복권을 응모했어요!"
- "응모한만큼 당첨될 확률이 올라가요"
- Home으로 돌아가기 버튼

## ⚠️ 에러 처리

### 시간 초과 에러
```
상황: 토요일 오후 8시 30분 이후 응모 시도
처리: 에러 토스트 표시
메시지: "응모 마감 시간이 지났습니다. 다음 회차 응모는..."
```

### 수량 에러
```
상황: 유효하지 않은 수량 입력
처리: 에러 토스트 표시
메시지: "응모 수량이 올바르지 않습니다. 100장~10,000장까지 100장 단위로 응모 가능합니다."
```

### 번호 에러
```
상황: 유효하지 않은 복권 번호
처리: 에러 토스트 표시
메시지: "X번째 복권의 번호가 올바르지 않습니다."
```

## 🎨 UI/UX 정책

### 토스트 메시지
- **성공**: 초록색, 체크 아이콘
- **에러**: 빨간색, 에러 아이콘
- **경고**: 주황색, 경고 아이콘
- **정보**: 파란색, 정보 아이콘

### 실시간 시간 표시
- **위젯**: RemainingTimeWidget
- **업데이트**: 1초마다 자동 업데이트
- **표시 형식**: "X일 X시간 X분" 또는 "X분 X초"

### 복권 번호 색상
- **1-10**: 주황색
- **11-20**: 파란색
- **21-30**: 빨간색
- **31-40**: 회색
- **41-45**: 초록색

## 🔧 기술 구현

### 핵심 클래스
- **SubmitPolicy**: 응모 정책 및 검증 로직
- **LottoGenerator**: 복권 번호 생성 및 색상 결정
- **LottoDateTime**: 한국 시간 기준 날짜/시간 계산
- **AppToast**: 토스트 메시지 표시
- **RemainingTimeWidget**: 실시간 시간 표시

### 검증 로직
```dart
// 최종 검증
final validation = SubmitPolicy.validateFinalSubmission(
  ticketCount: ticketCount,
  tickets: generatedTickets,
);

if (!validation['isValid']) {
  // 에러 처리
  final errors = validation['errors'] as List<String>;
  AppToast.error(context, message: errors.join('\n'));
}
```

### 라우팅 구조
```
/submit/loading    # 복권 생성 중
/submit/confirm    # 복권 확인
/submit/edit       # 번호 수정
/submit/complete   # 응모 완료
```

## 📊 성능 최적화

### 메모리 관리
- 타이머 자동 해제 (dispose 시)
- 위젯 마운트 상태 확인
- 불필요한 리빌드 방지

### 사용자 경험
- 로딩 상태 표시
- 진행 상황 피드백
- 명확한 에러 메시지
- 직관적인 네비게이션

## 🚀 향후 개선 사항

### 예정 기능
- [ ] 응모 히스토리 저장
- [ ] 즐겨찾기 번호 기능
- [ ] 통계 및 분석 기능
- [ ] 푸시 알림 (마감 1시간 전)

### 기술 개선
- [ ] 오프라인 모드 지원
- [ ] 데이터 동기화 최적화
- [ ] 캐싱 전략 구현
- [ ] A/B 테스트 프레임워크

---

**마지막 업데이트**: 2025-01-17 01:15:00 KST  
**다음 검토 예정일**: 2025-01-24  
**문서 버전**: v1.0.0
